#!/usr/bin/env python3
# -*- coding: utf-8; py-indent-offset:4 -*-
"""sad

Command line tool that takes a binary data string from Solana
account along with a yaml file describing the data and
generates a deserialized output"""

import io
import cmdline
from borsh_construct import U8, String, U32, Bool, CStruct, HashMap

animal = CStruct(
    "dname" / String,
    "legs" / U8,
)

emu = CStruct(
    "init" / Bool,
    "datalen" / U32,
    "mymap" / HashMap(
        String,
        String,
    ),
)

myhm = HashMap(String, String)
orig = "11200010003000666f6f300062617200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
from_scli = b"\x01\x12\x00\x00\x00\x01\x00\x00\x00\x03\x00\x00\x00666f6f\x03\x00\x00\x0062617200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
# from_here = b'\x01\x12\x00\x00\x00\x01\x00\x00\x00\x03\x00\x00\x00foo\x03\x00\x00\x00bar'

my_emu = emu.build({"init": True, "datalen": 18, "mymap": {"foo": "bar"}})
print(my_emu)

mystream = io.BytesIO(from_scli)
print(Bool.parse_stream(mystream))
y = U32.parse_stream(mystream)
print(y)
x = mystream.getvalue()[5:]
print(x)
print(orig.encode())
# print(myhm.parse_stream(mystream))
